---
title: "Comparing-Reprojections-HADs"
output: 
  github_document:
    keep_html: true
  html_document:
    theme: cosmo
    toc: TRUE
    toc_float: TRUE
    toc_depth: 4
    df_print: paged
  date: "`r format(Sys.Date())`"
---

```{r libs and setup, message=FALSE, warning=F}
rm(list=ls())

knitr::opts_knit$set(root.dir="/Volumes/vmfileshare/ClimateData/")

library(terra)
library(sp)

dd <- "/Volumes/vmfileshare/ClimateData/"

```


## **0. About**

Bias correction techniques in general require observational data to compare with climate projections in order to appropriately correct the bias. 

The [HadUK grid](https://catalogue.ceda.ac.uk/uuid/bbca3267dc7d4219af484976734c9527) is a 1km x 1km gridded dataset derived from meterological station observations. 

The first UKCP product for review is the UCKP convection-permitting dataset, on a 2.2km grid. Therefore, we are resmapling the 1km grid using bilenear interpolation to 2.2km grid extent. 

We have ran this seperately in both ```r``` and ```python```. The aim of this doc is to:

 - Ensure both methods produce the same result
 - Ensure the grid has been resampled to the correct extent and CRS 

## **1. Data** 

**1a. HadUK grid resampled in R**
    Resampling script [here](https://github.com/alan-turing-institute/clim-recal/blob/main/R/Resampling.HADs.inR.R)
    The 2.2km grid was derived from a reprojected (to BNG) UKCP 2.2km .nc file


In resampling it resampled the Sea as xx so replacing those vals as NA 

```{r load data 1}

r1 <- paste0(dd,"TestData.R-python/Resampled_HADs_tasmax.2000.01.tif")
r1 <- rast(r1)#Contains 31 layers for each day of Jan

#In the resampling, the method used seemed to have relable all Sea values as '1.000000e+20' so relabelling them here (but to be checked as to why they've been valued like this in the resampling)
r1[r1 > 200] = NA

#check the crs
crs(r1, proj=T)

#Plot to check
plot(r1$tasmax_1)

```

**1b. HadUK grid resampled in python**
  Resampling script [here](https://github.com/alan-turing-institute/clim-recal/blob/main/python/resampling/resampling_hads.py)

```{r load data 2}

py.pros.tasmax <- list.files(paste0(dd, "Processed/HadsUKgrid/resampled_2.2km/tasmax/day"))
r2 <- py.pros.tasmax[grepl("200001", py.pros.tasmax)]

```

**1b. Cropped extent**
  Just comparing by cropping to Scotland (bbox created [here](https://github.com/alan-turing-institute/clim-recal/tree/main/data/Scotland))

```{r}
scotland <- vect("~/Library/CloudStorage/OneDrive-TheAlanTuringInstitute/CLIM-RECAL/clim-recal/data/Scotland/Scotland.bbox.shp")
```

## **2. Comparisons **

Crop extents to be the same 

```{r}

```

