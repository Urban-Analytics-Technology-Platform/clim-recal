---
title: "WIP Assessing bias corrected data"
author: "Ruth C E Bowyer"
output: 
  github_document:
    keep_html: true
  html_document:
    theme: cosmo
    toc: TRUE
    toc_float: TRUE
    toc_depth: 4
    df_print: paged
  date: "`r format(Sys.Date())`"
---

```{r libs and setup, message=FALSE, warning=F}
rm(list=ls())

knitr::opts_knit$set(root.dir="/Volumes/vmfileshare/ClimateData/")

library(terra)
library(sp)
library(exactextractr)

dd <- "/Volumes/vmfileshare/ClimateData/"

```


## **0. About**

Assessing the bias correction applied using the ```cmethods``` package. 

## **0. Raw data**

Comparing to the 'Raw' (but reprojecte CPM data) 

```{r load raw data}
# Read in as list of quantile mapping data
## Each decade is seperated out - but potential should we brick these together?
p <- paste0(dd, "Reprojected/UKCP2.2/tasmax/01/latest/")
files <- list.files(p)

raw.files <- files[!grepl("aux.xml", files)]
raw.files.p <- paste0(p, raw.files)
raw.dat <- lapply(raw.files.p, rast) 

#Crop to Scotland extent 
scot <- vect("~/Library/CloudStorage/OneDrive-TheAlanTuringInstitute/CLIM-RECAL/clim-recal/data/Scotland/Scotland.bbox.shp")

raw.dat_c <- lapply(raw.dat, function(i){ crop(i, scot) })

raw.dat_r <- rast(raw.dat_c)
```



##**1. Bias corrected data **

Load and check files 

```{r load data 1}

# Each method is a sep file per decade 
p <- paste0(dd, "Debiased/tasmax/")
m <- list.files(p)

cmethods <- gsubc("")

debaised_data <- lapply()

files <- list.files(p)
qm.files <- files[grepl(i, files)]
qm.files.p <- paste0(p, qm.files)
qm.dat <- lapply(qm.files.p, rast) 

#Load all together
qm.files.r <- rast(qm.files.p)


nlyr(qm.files.r) #144000 - 40 x 12 x 30 day months
```

## **2. Assessing the bias correction methods**

### **2a. Time series**

Check the time series over the whole dataset makes sense

```{r}

```



